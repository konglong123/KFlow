<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link href="../../Scripts/easyUI/themes/default/easyui.css" rel="stylesheet" type="text/css" />
    <script src="../../Scripts/jquery-1.7.2.min.js" type="text/javascript"></script>
    <script src="../../Scripts/easyUI/jquery.easyui.min.js" type="text/javascript"></script>
    <script src="../../Scripts/QueryString.js" type="text/javascript"></script>
    <script src="../../Scripts/EasyUIUtility.js" type="text/javascript"></script>
</head>
<body>
<div>
    <fieldset>
        <table cellpadding="5">
            <tr>
                <td>种群数：</td>
                <td><input id="groupNum" value="10" class="easyui-textbox" type="text" placeholder="默认100"></td>
                <td>进化代数：</td>
                <td><input class="easyui-textbox" type="text" id="generateNum" value="50" placeholder="默认50"></td>
                <td>推荐结果保存数：</td>
                <td><input class="easyui-textbox" type="text" id="saveNum" value="1" placeholder="默认3"></td>
            </tr>
            <tr>
                <td>变异率：</td>
                <td><input class="easyui-textbox" type="text" id="variationPro" value="0.5" placeholder="默认0.5"></td>
                <td>交叉率：</td>
                <td><input class="easyui-textbox" type="text" id="acrossPro" value="0.7" placeholder="默认0.7"></td>
                <td>精英选择比：</td>
                <td><input class="easyui-textbox" type="text" id="elitePro" value="0.1" placeholder="默认0.1"></td>
            </tr>
        </table>
    </fieldset>
    <div style="text-align:right;padding:5px">
        <button class="easyui-linkbutton" onclick="getCompose()" >智能推荐</button>
        <button class="easyui-linkbutton" onclick="updateWord2Document()" >同步W2V数据</button>
    </div>
</div>
<div id="composeResult">
    <table id="dgComposeResults" title="推荐列表">
    </table>
</div>
<div id="composeHistory">
    <table id="dgComposeHistory" title="推荐记录">
    </table>
</div>
<script type="text/javascript">
    $(function(){
        var flowNo=GetQueryString("FK_Flow");
        initComposeHistory(flowNo);
    });
    
    function initComposeHistory(flowNo) {
        $('#dgComposeHistory').datagrid({
            singleSelect:true,
            autoRowHeight:false,
            pagination:true,
            pageSize: 10,
            pageList:[10,25,50,100],
            nowrap:false,//数据多行显示
            fitColumns:true,//表头与数据对齐
            url:"/WF/composeGroup/getComposeGroups",
            queryParams: {
                flowNo:flowNo
            },
            columns:[[
                {field:'No',title: '编号',align: 'center',width:10},
                {field:'score',title: '相似度值',align: 'center',width:10},
                {field:'newFlowNo',title: '组合流程编码',align: 'center',width:10},
                {field:'groupNum',title: '种群数',align: 'center',width:10},
                {field:'variationPro',title: '变异率',align: 'center',width:10},
                {field:'acrossPro',title: '交叉率',align: 'center',width:10},
                {field:'elitePro',title: '精英比例',align: 'center',width:10},
                {field:'generateNum',title: '进化代数',align: 'center',width:10},
                {field:'action',title: '操作',align: 'center',width:20,
                    formatter:function(val,rec){
                        var str="<input type='button' value='流程详情'  onclick='gotoComposeFlowDetail(\""+rec.newFlowNo+"\")'/>";
                        str+="<input type='button' value='进化过程'  />";
                        str+="<input type='button' value='详情'  />";
                        return str;
                    }},
            ]]
        });
    }

    function gotoComposeFlowDetail(flowNo) {

        var url="/WF/WF/Admin/CCBPMDesigner/Designer.htm?FK_Flow="+flowNo+"&UserNo=admin";
        var self = window.open(url);
    }

    function getCompose() {
        var flowNo=GetQueryString("FK_Flow");
        $.ajax({
            type: 'POST',
            url: "/WF/composeGroup/composeNodeGroup",
            data: {
                flowNo:flowNo,
                groupNum:$("#groupNum").val().trim(),
                generateNum:$("#generateNum").val().trim(),
                variationPro:$("#variationPro").val().trim(),
                acrossPro:$("#acrossPro").val().trim(),
                elitePro:$("#elitePro").val().trim(),
                saveNum:$("#saveNum").val().trim()
            },
            success: function (data) {
                $("#dgComposeHistory").datagrid('reload');
            },
            error: function (data) {
                alert("推荐异常"+data);
            }
        });
    }

    function updateWord2Document() {
        $.ajax({
            type: 'get',
            async: false,
            url: "/WF/NLPModel/updateW2VDocument",
            success: function (data) {
                alert("同步成功！");
            },
            error: function (data) {
                alert("同步异常"+data);
            }
        });

    }
</script>
</body>
</html>